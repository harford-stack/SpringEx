<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.test1.mapper.MemberMapper">
	<select id="memberLogin" parameterType="hashmap" resultType="com.example.test1.model.Member">
		SELECT *
		FROM TBL_USER
		WHERE USERID = #{id}
		<!-- AND PASSWORD = #{pwd} 해시 적용 후 제거 -->
	</select>
	
	<select id="memberCheck" parameterType="hashmap" resultType="com.example.test1.model.Member">
		SELECT *
		FROM TBL_USER
		WHERE USERID = #{id}
		<if test="name != '' and name != null">
			AND NAME = #{name}
		</if>
		<if test="phone != '' and phone != null">
			AND PHONE = #{phone}
		</if>
	</select>
	
	<insert id="memberAdd" parameterType="hashmap">
		INSERT INTO TBL_USER
		VALUES(#{id}, #{hashPwd}, #{name}, NULL, NULL, NULL, #{addr}, #{phone}, NULL, #{gender}, #{status}, SYSDATE, SYSDATE, 0)
	</insert>
	
	<insert id="insertMemberImg" parameterType="hashmap">
		INSERT INTO TBL_USER_FILE
		VALUES (USERFILE_SEQ.NEXTVAL, #{userId}, #{path}, #{fileName}, #{orgName}, #{size}, #{ext})
	</insert>
	
	<select id="selectFileList" parameterType="hashmap" resultType="com.example.test1.model.Member">
		SELECT *
		FROM TBL_USER_FILE
		WHERE USERID = #{userId}
	</select>
	
	<select id="selectMemberList" parameterType="hashmap" resultType="com.example.test1.model.Member">
		SELECT 
			U.*, 
			NVL2 (BIRTH, (SUBSTR(BIRTH, 3, 2) || '.' || SUBSTR(BIRTH, 5, 2) || '.' || SUBSTR(BIRTH, 7, 2)), '정보없음') CBIRTH
		FROM TBL_USER U
	</select>
	
	<update id="cntIncrease" parameterType="hashmap">
		<!-- 로그인 실패 시 -->
		UPDATE TBL_USER
		SET CNT = CNT + 1
		WHERE USERID = #{id}
	</update>
	
	<update id="cntInit" parameterType="hashmap">
		<!-- 로그인 성공 시 -->
		UPDATE TBL_USER
		SET CNT = 0
		WHERE USERID = #{id}
	</update>
	
	<!-- resultType에 따른 두가지 방법 // id가 pk값이므로 결과는 0아니면 1 -->
	<select id="authMember1" parameterType="hashmap" resultType="com.example.test1.model.Member">
		SELECT *
		FROM TBL_USER
		WHERE
			USERID = #{userId} AND NAME = #{name}
			AND REPLACE(PHONE, '-', '') = #{phone}
	</select>
	<select id="authMember2" parameterType="hashmap" resultType="int">
		SELECT COUNT(*)
		FROM TBL_USER
		WHERE
			USERID = #{userId} AND NAME = #{name}
			AND REPLACE(PHONE, '-', '') = #{phone}
	</select>
	
	<update id="updatePwd" parameterType="hashmap">
		UPDATE TBL_USER
		SET
			PASSWORD = #{hashPwd}
		WHERE USERID = #{userId}
	</update>
	
</mapper>